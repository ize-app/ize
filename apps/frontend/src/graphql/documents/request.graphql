mutation NewRequest($request: NewRequestArgs!) {
  newRequest(request: $request)
}

mutation NewResponse($response: NewResponseArgs!) {
  newResponse(response: $response)
}

mutation NewEvolveRequest($request: NewEvolveRequestArgs!) {
  newEvolveRequest(request: $request)
}

query getRequest($requestId: String!) {
  getRequest(requestId: $requestId) {
    ...Request
  }
}

mutation EndRequestStep($requestStepId: String!) {
  endRequestStep(requestStepId: $requestStepId)
}

query getRequests(
  $cursor: String
  $limit: Int!
  $userOnly: Boolean!
  $flowId: String
  $groupId: String
  $searchQuery: String!
  $statusFilter: RequestStepStatusFilter!
  $respondPermissionFilter: RequestStepRespondPermissionFilter!
) {
  getRequests(
    cursor: $cursor
    limit: $limit
    userOnly: $userOnly
    flowId: $flowId
    groupId: $groupId
    searchQuery: $searchQuery
    statusFilter: $statusFilter
    respondPermissionFilter: $respondPermissionFilter
  ) {
    ...RequestSummary
  }
}

fragment Request on Request {
  name
  creator {
    ...Entity
  }
  flow {
    ...Flow
  }
  triggerFieldAnswers {
    ...TriggerFieldAnswer
  }
  requestId
  currentStepIndex
  createdAt
  requestSteps {
    ...RequestStep
  }
  final
}

fragment RequestStep on RequestStep {
  requestStepId
  createdAt
  expirationDate
  responseFieldAnswers {
    ...ResponseFieldAnswers
  }
  fieldSet {
    ...FieldSet
  }
  userResponses {
    ...Response
  }
  results {
    ...ResultGroup
  }
  actionExecution {
    ...ActionExecution
  }
  status {
    ...RequestStepStatus
  }
}

fragment RequestSummary on RequestSummary {
  id
  requestStepId
  requestId
  flowId
  requestName
  flowName
  userResponded
  creator {
    ...Entity
  }
  respondPermission {
    ...Permission
  }
  userRespondPermission
  stepIndex
  totalSteps
  createdAt
  expirationDate
  status {
    ...RequestStepStatus
  }
}

fragment Response on Response {
  responseId
  createdAt
  creator {
    ...Entity
  }
  answers {
    ...FieldAnswer
  }
}

fragment RequestStepStatus on RequestStepStatus {
  responseFinal
  resultsFinal
  actionsFinal
  final
}
