type Mutation {
  newRequest(request: NewRequestArgs!): String!
  newEvolveRequest(request: NewEvolveRequestArgs!): String!
  newResponse(response: NewResponseArgs!): String!
}

type Query {
  getRequest(requestId: String!): Request!
  getRequestSteps(
    cursor: String
    limit: Int!
    userOnly: Boolean!
    flowId: String
    searchQuery: String!
    filter: RequestStepFilter!
  ): [RequestStepSummary!]!
}

input NewRequestArgs {
  flowId: String!
  name: String!
  requestFields: [FieldAnswerArgs!]!
  requestDefinedOptions: [RequestDefinedOptionsArgs!]!
}

input NewEvolveRequestArgs {
  flowId: String!
  name: String!
  description: String
  proposedFlow: NewFlowArgs!
  currentFlow: NewFlowArgs!
}

input RequestDefinedOptionsArgs {
  fieldId: String!
  options: [FieldOptionArgs!]!
}

input NewResponseArgs {
  requestStepId: String!
  answers: [FieldAnswerArgs!]!
}

enum Status {
  NotAttempted
  InProgress
  Completed
  Failure
  Cancelled
}

enum RequestStepFilter {
  All
  Open
  Closed
}

type Request {
  # refers to flow version at time of request, not necessarily the current flow
  name: String!
  flow: Flow!
  creator: User!
  requestId: String!
  currentStepIndex: Int!
  createdAt: String!
  final: Boolean!
  steps: [RequestStep!]!
}

type RequestStep {
  requestStepId: String!
  createdAt: String!
  expirationDate: String!
  requestFieldAnswers: [FieldAnswer!]!
  responseFieldAnswers: [UserFieldAnswers!]!
  responseFields: [Field!]!
  userResponses: [Response!]!
  results: [Result!]!
  actionExecution: ActionExecution
  responseComplete: Boolean!
  resultsComplete: Boolean!
  final: Boolean!
}

type RequestStepSummary {
  id: String! # same as requestStepId, might delete requestStepId later
  requestStepId: String!
  requestId: String!
  flowId: String!
  # user who triggered the first step of this request
  creator: User!
  requestName: String!
  respondPermission: Permission
  userRespondPermission: Boolean!
  flowName: String!
  stepIndex: Int!
  totalSteps: Int!
  createdAt: String!
  expirationDate: String!
  responseComplete: Boolean!
  resultsComplete: Boolean!
  actionsComplete: Boolean!
  final: Boolean!
}

type Response {
  responseId: String!
  createdAt: String!
  user: User!
  answers: [FieldAnswer!]!
}

type GenericFieldAndValue {
  fieldName: String!
  value: [String!]!
}
